generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  name         String
  email        String         @unique
  password     String
  role         UserRole       @default(USER)
  attendances  Attendance[]
  userLocations UserLocation[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model Location {
  id            String         @id @default(cuid())
  name          String         @unique
  latitude      Float
  longitude     Float
  radius        Int            @default(200)
  isActive      Boolean        @default(true)
  attendances   Attendance[]
  userLocations UserLocation[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model UserLocation {
  id         String   @id @default(cuid())
  userId     String
  locationId String
  createdAt  DateTime @default(now())

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([userId, locationId])
  @@index([locationId])
}

model Attendance {
  id           String         @id @default(cuid())
  userId       String
  locationId   String
  type         AttendanceType
  latitude     Float
  longitude    Float
  distance     Float
  faceDetected Boolean        @default(false)
  createdAt    DateTime       @default(now())

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([locationId, createdAt])
}

enum AttendanceType {
  MORNING_IN
  LUNCH_OUT
  AFTERNOON_IN
  EVENING_OUT
}

enum UserRole {
  ADMIN
  USER
}
